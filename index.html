<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>저스트뮤직아카데미 동탄점 - 연습 기록부</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-color: #4f46e5;
            --accent-color-start: #4338ca;
            --accent-color-end: #6366f1;
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #f8fafc; 
            color: #1e293b; 
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .gradient-header-bg {
            background: linear-gradient(135deg, var(--accent-color-start), var(--accent-color-end)) !important;
            position: relative; overflow: hidden; color: white; z-index: 1;
        }

        .gradient-header-bg::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=2070&auto=format&fit=crop');
            background-position: center; background-size: cover;
            opacity: 0.15; mix-blend-mode: multiply; z-index: -1; pointer-events: none;
        }

        .material-section {
            background: white; border-radius: 1.25rem; padding: 1.25rem; margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
        }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }

        .day-box {
            border: 1px solid #e2e8f0; border-radius: 10px; padding: 6px;
            min-height: 70px; cursor: pointer; position: relative; transition: 0.2s;
            background: white; z-index: 10;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        @media (min-width: 768px) {
            .day-box { min-height: 80px; padding: 8px; }
            .calendar-grid { gap: 8px; }
        }

        .day-box.has-content { border-top: 4px solid #4338ca; background-color: #fcfdff; }

        .input-style {
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            color: white; padding: 0.6rem 1rem; border-radius: 0.5rem;
            width: 100%; outline: none; transition: all 0.3s; position: relative; z-index: 20;
            font-size: 16px !important;
        }

        .copyright-text {
            text-align: center; color: #94a3b8; font-size: 11px; font-weight: 500;
            padding: 1.5rem 0; letter-spacing: -0.02em;
        }

        /* [핵심] 한 장 출력을 위한 인쇄 엔진 수정 */
        @media print {
            @page { 
                size: A4 landscape; 
                margin: 0; /* 여백 제거 후 내부 패딩으로 조절 */
            }
            
            html, body {
                width: 297mm;
                height: 210mm;
                overflow: hidden; /* 페이지 넘침 강제 방지 */
            }

            body { 
                background-color: #f8fafc !important; 
                padding: 10mm !important; 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
            }

            .no-print { display: none !important; }

            /* 인쇄 시 레이아웃 강제 교정 */
            .max-w-6xl { max-width: 100% !important; width: 100% !important; margin: 0 !important; }
            
            .grid-container { 
                display: grid !important; 
                grid-template-columns: repeat(12, 1fr) !important; 
                gap: 15px !important; 
            }
            
            .calendar-col { grid-column: span 8 / span 8 !important; }
            .stats-col { grid-column: span 4 / span 4 !important; }
            
            /* 높이 자동 조절 */
            .material-section { margin-bottom: 0 !important; padding: 12px !important; }
            .day-box { min-height: 55px !important; }
            .gradient-header-bg { padding: 1.5rem !important; margin-bottom: 12px !important; border-radius: 15px !important; }
            
            canvas { max-height: 180px !important; }
            
            .copyright-text { 
                position: absolute; 
                bottom: 5mm; 
                left: 0; 
                right: 0; 
                padding: 0 !important;
            }
        }
    </style>
</head>
<body class="p-3 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="gradient-header-bg rounded-2xl md:rounded-3xl p-6 md:p-8 mb-6 md:mb-8 shadow-xl">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative">
                <div class="w-full md:w-2/3">
                    <div class="flex items-center gap-2 mb-2 opacity-90">
                        <i class="fas fa-shield-alt text-xs"></i>
                        <span class="text-xs md:text-sm font-bold tracking-widest uppercase">저스트뮤직아카데미 동탄점</span>
                    </div>
                    <h1 class="text-2xl md:text-4xl font-black mb-6 tracking-tight">2026 PRACTICE LOG</h1>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-md no-print">
                        <input type="text" id="userName" placeholder="이름 입력" oninput="saveProfile()" class="input-style">
                        <input type="text" id="userMajor" placeholder="전공 입력" oninput="saveProfile()" class="input-style">
                    </div>

                    <div class="hidden print:block mt-2">
                        <span class="text-3xl font-bold" id="printName"></span>
                        <span class="mx-3 opacity-50">|</span>
                        <span class="text-3xl" id="printMajor"></span>
                    </div>
                </div>
                <div class="no-print w-full md:w-auto flex justify-end">
                    <button onclick="window.print()" class="w-full md:w-auto bg-white text-indigo-700 hover:bg-indigo-50 px-8 py-4 rounded-2xl font-extrabold transition shadow-xl flex items-center justify-center gap-2 text-lg">
                        <i class="fas fa-file-pdf"></i>
                        <span>PDF 리포트 저장</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4 no-print">
            <div class="bg-white px-4 py-2 rounded-xl border shadow-sm w-full sm:w-auto flex items-center gap-3">
                <i class="fas fa-calendar-alt text-indigo-500"></i>
                <select id="monthSelect" class="font-bold text-lg outline-none cursor-pointer w-full bg-transparent" onchange="changeMonth()">
                    <option value="1">2026년 1월</option><option value="2">2026년 2월</option>
                    <option value="3">2026년 3월</option><option value="4">2026년 4월</option>
                    <option value="5">2026년 5월</option><option value="6">2026년 6월</option>
                    <option value="7">2026년 7월</option><option value="8">2026년 8월</option>
                    <option value="9">2026년 9월</option><option value="10">2026년 10월</option>
                    <option value="11">2026년 11월</option><option value="12">2026년 12월</option>
                </select>
            </div>
            <div class="text-sm text-slate-400 font-medium">
                <i class="fas fa-check-circle text-green-500 mr-1"></i> 모든 데이터는 기기에 자동 저장됩니다.
            </div>
        </div>

        <div class="grid-container grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="calendar-col lg:col-span-8 order-2 lg:order-1">
                <div class="material-section h-full">
                    <div id="calendarContainer" class="calendar-grid"></div>
                </div>
            </div>
            <div class="stats-col lg:col-span-4 order-1 lg:order-2">
                <div class="material-section h-full flex flex-col justify-between">
                    <div>
                        <div class="bg-indigo-600 rounded-xl p-5 text-white mb-6">
                            <p class="text-indigo-100 text-[10px] font-bold mb-1 uppercase">Monthly Total</p>
                            <h2 id="totalTimeDisplay" class="text-5xl font-black italic">0.0<span class="text-lg ml-1 font-normal opacity-70">hrs</span></h2>
                        </div>
                        <div class="mb-4 h-[220px]"><canvas id="mixedChart"></canvas></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 pt-4 border-t border-slate-100">
                        <div class="p-3 bg-slate-50 rounded-xl text-center">
                            <p class="text-[10px] text-slate-400 font-bold uppercase">연습 일수</p>
                            <p id="recordedDays" class="text-xl font-bold text-slate-700">0일</p>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-xl text-center">
                            <p class="text-[10px] text-slate-400 font-bold uppercase">평균 시간</p>
                            <p id="avgTime" class="text-xl font-bold text-indigo-600">0.0h</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="copyright-text">
            본 양식은 저스트뮤직아카데미의 소유 자산으로 무단 복제 또는 사용을 금합니다.
        </footer>
    </div>

    <div id="memoModal" class="fixed inset-0 z-[100] flex items-end md:items-center justify-center p-0 md:p-4" style="display:none;">
        <div class="modal-overlay absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="bg-white rounded-t-3xl md:rounded-3xl w-full max-w-md p-6 md:p-8 relative z-10 shadow-2xl transition-all">
            <div class="w-12 h-1 bg-slate-200 rounded-full mx-auto mb-6 md:hidden"></div>
            <h3 class="text-xl font-bold text-slate-800 mb-6" id="modalTitle">기록</h3>
            <div class="space-y-4">
                <input type="number" id="modalTime" step="0.5" class="w-full bg-slate-50 border-2 border-slate-50 rounded-xl p-4 text-2xl font-black text-indigo-600 outline-none focus:border-indigo-500" placeholder="0.0" inputmode="decimal">
                <textarea id="modalNote" rows="4" class="w-full bg-slate-50 border-2 border-slate-50 rounded-xl p-4 text-sm outline-none focus:border-indigo-500" placeholder="연습 메모 입력"></textarea>
                <button onclick="saveMemo()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold text-lg hover:bg-indigo-700">저장하기</button>
            </div>
        </div>
    </div>

    <script>
        let myChart = null, currentMonth = 1, selectedDay = null, monthlyData = {};
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('userName').value = localStorage.getItem('m_name') || '';
            document.getElementById('userMajor').value = localStorage.getItem('m_major') || '';
            updatePrintProfile();
            currentMonth = parseInt(localStorage.getItem('m_month')) || 1;
            document.getElementById('monthSelect').value = currentMonth;
            initApp();
        });
        function saveProfile() {
            localStorage.setItem('m_name', document.getElementById('userName').value);
            localStorage.setItem('m_major', document.getElementById('userMajor').value);
            updatePrintProfile();
        }
        function updatePrintProfile() {
            document.getElementById('printName').innerText = document.getElementById('userName').value || '입시생';
            document.getElementById('printMajor').innerText = document.getElementById('userMajor').value || '전공 미입력';
        }
        function changeMonth() {
            currentMonth = parseInt(document.getElementById('monthSelect').value);
            localStorage.setItem('m_month', currentMonth);
            initApp();
        }
        function initApp() {
            const saved = localStorage.getItem(`m_data_2026_${currentMonth}`);
            monthlyData = saved ? JSON.parse(saved) : {};
            renderCalendar();
            updateDashboard();
        }
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            const daysInMonth = new Date(2026, currentMonth, 0).getDate();
            const firstDay = new Date(2026, currentMonth - 1, 1).getDay();
            ['일','월','화','수','목','금','토'].forEach(d => {
                container.innerHTML += `<div class="text-center text-[10px] font-black text-slate-300 pb-2">${d}</div>`;
            });
            for (let i = 0; i < firstDay; i++) container.appendChild(document.createElement('div'));
            for (let d = 1; d <= daysInMonth; d++) {
                const dayInfo = monthlyData[d] || { time: 0 };
                const box = document.createElement('div');
                box.className = `day-box ${dayInfo.time > 0 ? 'has-content' : ''}`;
                box.onclick = () => openModal(d);
                box.innerHTML = `<div class="text-[10px] font-bold ${dayInfo.time > 0 ? 'text-indigo-600' : 'text-slate-400'}">${d}</div><div class="text-center mt-1 font-black text-lg md:text-xl text-slate-700">${dayInfo.time > 0 ? dayInfo.time : ''}</div><div></div>`;
                container.appendChild(box);
            }
        }
        function openModal(day) {
            selectedDay = day;
            const data = monthlyData[day] || { time: '', note: '' };
            document.getElementById('modalTitle').innerText = `${currentMonth}월 ${day}일 기록`;
            document.getElementById('modalTime').value = data.time;
            document.getElementById('modalNote').value = data.note || '';
            document.getElementById('memoModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('memoModal').style.display = 'none'; }
        function saveMemo() {
            monthlyData[selectedDay] = { 
                time: parseFloat(document.getElementById('modalTime').value) || 0,
                note: document.getElementById('modalNote').value 
            };
            localStorage.setItem(`m_data_2026_${currentMonth}`, JSON.stringify(monthlyData));
            closeModal();
            renderCalendar();
            updateDashboard();
        }
        function updateDashboard() {
            const times = [], labels = [];
            let total = 0, count = 0;
            const daysInMonth = new Date(2026, currentMonth, 0).getDate();
            for(let i=1; i<=daysInMonth; i++) {
                const t = monthlyData[i]?.time || 0;
                times.push(t); labels.push(i);
                total += t; if(t > 0) count++;
            }
            document.getElementById('totalTimeDisplay').innerHTML = `${total.toFixed(1)}<span class="text-lg ml-1 font-normal opacity-70">hrs</span>`;
            document.getElementById('recordedDays').innerText = `${count}일`;
            document.getElementById('avgTime').innerText = count > 0 ? `${(total/count).toFixed(1)}h` : '0.0h';
            const ctx = document.getElementById('mixedChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                data: {
                    labels: labels,
                    datasets: [
                        { type: 'line', data: times, borderColor: '#4338ca', borderWidth: 2, pointRadius: 0, fill: false, tension: 0 },
                        { type: 'bar', data: times, backgroundColor: 'rgba(99, 102, 241, 0.2)', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, animation: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, display: false }, x: { grid: { display: false }, ticks: { font: { size: 8 } } } }
                }
            });
        }
    </script>
</body>
</html>